2025-07-09 16:31:40,811 - __main__ - INFO - Received query request
2025-07-09 16:31:40,811 - __main__ - INFO - Processing query: what was the document about langchain?
2025-07-09 16:31:40,820 - __main__ - ERROR - Error processing query: 'Input to PromptTemplate is missing variables {"\'start_date\'"}.  Expected: ["\'start_date\'", \'query\', \'today_date\'] Received: [\'query\', \'today_date\']\nNote: if you intended {\'start_date\'} to be part of the string and not a variable, please escape it with double curly braces like: \'{{\'start_date\'}}\'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT '
Traceback (most recent call last):
  File "/Users/apoorvabhishek/Documents/ai-tutorials/rag-chrome-extension/backend/main.py", line 282, in query_pages
    start_date, end_date = parse_date_query(question)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/apoorvabhishek/Documents/ai-tutorials/rag-chrome-extension/backend/main.py", line 65, in parse_date_query
    response = chain.invoke({"query": query, "today_date": datetime.now().strftime('%Y-%m-%d')})
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/apoorvabhishek/Library/Python/3.11/lib/python/site-packages/langchain_core/runnables/base.py", line 3045, in invoke
    input_ = context.run(step.invoke, input_, config, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/apoorvabhishek/Library/Python/3.11/lib/python/site-packages/langchain_core/prompts/base.py", line 216, in invoke
    return self._call_with_config(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/apoorvabhishek/Library/Python/3.11/lib/python/site-packages/langchain_core/runnables/base.py", line 1940, in _call_with_config
    context.run(
  File "/Users/apoorvabhishek/Library/Python/3.11/lib/python/site-packages/langchain_core/runnables/config.py", line 428, in call_func_with_variable_args
    return func(input, **kwargs)  # type: ignore[call-arg]
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/apoorvabhishek/Library/Python/3.11/lib/python/site-packages/langchain_core/prompts/base.py", line 189, in _format_prompt_with_error_handling
    _inner_input = self._validate_input(inner_input)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/apoorvabhishek/Library/Python/3.11/lib/python/site-packages/langchain_core/prompts/base.py", line 183, in _validate_input
    raise KeyError(
KeyError: 'Input to PromptTemplate is missing variables {"\'start_date\'"}.  Expected: ["\'start_date\'", \'query\', \'today_date\'] Received: [\'query\', \'today_date\']\nNote: if you intended {\'start_date\'} to be part of the string and not a variable, please escape it with double curly braces like: \'{{\'start_date\'}}\'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT '
2025-07-09 16:33:43,142 - __main__ - INFO - Successfully connected to MongoDB
2025-07-09 16:33:46,310 - __main__ - INFO - Received query request
2025-07-09 16:33:46,310 - __main__ - INFO - Processing query: what was the document about langchain?
2025-07-09 16:33:47,387 - __main__ - ERROR - Error processing query: the JSON object must be str, bytes or bytearray, not AIMessage
Traceback (most recent call last):
  File "/Users/apoorvabhishek/Documents/ai-tutorials/rag-chrome-extension/backend/main.py", line 282, in query_pages
    start_date, end_date = parse_date_query(question)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/apoorvabhishek/Documents/ai-tutorials/rag-chrome-extension/backend/main.py", line 69, in parse_date_query
    date_info = json.loads(response)
                ^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/json/__init__.py", line 339, in loads
    raise TypeError(f'the JSON object must be str, bytes or bytearray, '
TypeError: the JSON object must be str, bytes or bytearray, not AIMessage
2025-07-09 16:35:37,938 - __main__ - INFO - Successfully connected to MongoDB
2025-07-09 16:35:42,624 - __main__ - INFO - Received query request
2025-07-09 16:35:42,624 - __main__ - INFO - Processing query: what was the document about langchain?
2025-07-09 16:35:43,551 - __main__ - ERROR - Failed to parse date LLM response as JSON: content="{'start_date': null, 'end_date': null}" additional_kwargs={} response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []} id='run--8543737b-4464-45cc-9536-f6d753350e4b-0' usage_metadata={'input_tokens': 253, 'output_tokens': 15, 'total_tokens': 268, 'input_token_details': {'cache_read': 0}} - Expecting property name enclosed in double quotes: line 1 column 2 (char 1)
2025-07-09 16:35:43,551 - __main__ - INFO - No date information found in query: 'what was the document about langchain?'. Proceeding without date filter.
2025-07-09 16:35:43,932 - __main__ - ERROR - Error processing query: 'VectorStoreRetriever' object has no attribute 'as_retriever'
Traceback (most recent call last):
  File "/Users/apoorvabhishek/Documents/ai-tutorials/rag-chrome-extension/backend/main.py", line 325, in query_pages
    qa_chain = get_conversational_chain(retriever) # Pass the retriever to the conversational chain
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/apoorvabhishek/Documents/ai-tutorials/rag-chrome-extension/backend/main.py", line 154, in get_conversational_chain
    retriever=vector_store.as_retriever()
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/apoorvabhishek/Library/Python/3.11/lib/python/site-packages/pydantic/main.py", line 991, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'VectorStoreRetriever' object has no attribute 'as_retriever'
2025-07-09 16:36:43,995 - __main__ - INFO - Successfully connected to MongoDB
2025-07-09 16:36:46,573 - __main__ - INFO - Received query request
2025-07-09 16:36:46,574 - __main__ - INFO - Processing query: what was the document about langchain?
2025-07-09 16:36:47,515 - __main__ - ERROR - Failed to parse date LLM response as JSON: content="{'start_date': null, 'end_date': null}" additional_kwargs={} response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []} id='run--3f034d85-3109-48c6-a8e8-782a7b18751f-0' usage_metadata={'input_tokens': 253, 'output_tokens': 15, 'total_tokens': 268, 'input_token_details': {'cache_read': 0}} - Expecting property name enclosed in double quotes: line 1 column 2 (char 1)
2025-07-09 16:36:47,516 - __main__ - INFO - No date information found in query: 'what was the document about langchain?'. Proceeding without date filter.
2025-07-09 16:36:50,682 - __main__ - INFO - Successfully processed query
2025-07-09 16:38:01,983 - __main__ - INFO - Received query request
2025-07-09 16:38:01,985 - __main__ - INFO - Processing query: summarise the documents from today
2025-07-09 16:38:02,827 - __main__ - ERROR - Failed to parse date LLM response as JSON: content='```json\n{"start_date": "2025-07-09", "end_date": "2025-07-09"}\n```' additional_kwargs={} response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []} id='run--f5321fc3-1354-40d4-a61d-16a18363dc0a-0' usage_metadata={'input_tokens': 250, 'output_tokens': 39, 'total_tokens': 289, 'input_token_details': {'cache_read': 0}} - Expecting value: line 1 column 1 (char 0)
2025-07-09 16:38:02,827 - __main__ - INFO - No date information found in query: 'summarise the documents from today'. Proceeding without date filter.
2025-07-09 16:38:04,478 - __main__ - INFO - Successfully processed query
2025-07-09 16:38:15,877 - __main__ - INFO - Received query request
2025-07-09 16:38:15,878 - __main__ - INFO - Processing query: summarise the documents from yesterday
2025-07-09 16:38:16,815 - __main__ - ERROR - Failed to parse date LLM response as JSON: content='```json\n{"start_date": "2025-07-08", "end_date": "2025-07-08"}\n```' additional_kwargs={} response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []} id='run--38151069-9403-4742-8215-b5d1e86e6159-0' usage_metadata={'input_tokens': 250, 'output_tokens': 39, 'total_tokens': 289, 'input_token_details': {'cache_read': 0}} - Expecting value: line 1 column 1 (char 0)
2025-07-09 16:38:16,815 - __main__ - INFO - No date information found in query: 'summarise the documents from yesterday'. Proceeding without date filter.
2025-07-09 16:38:18,619 - __main__ - INFO - Successfully processed query
2025-07-09 16:38:26,118 - __main__ - INFO - Received query request
2025-07-09 16:38:26,119 - __main__ - INFO - Processing query: summarise the documents from last year
2025-07-09 16:38:27,274 - __main__ - ERROR - Failed to parse date LLM response as JSON: content='```json\n{"start_date": "2024-01-01", "end_date": "2024-12-31"}\n```' additional_kwargs={} response_metadata={'prompt_feedback': {'block_reason': 0, 'safety_ratings': []}, 'finish_reason': 'STOP', 'model_name': 'gemini-2.0-flash', 'safety_ratings': []} id='run--c9e36e9b-3cd7-4b9a-8431-42590da34527-0' usage_metadata={'input_tokens': 251, 'output_tokens': 39, 'total_tokens': 290, 'input_token_details': {'cache_read': 0}} - Expecting value: line 1 column 1 (char 0)
2025-07-09 16:38:27,274 - __main__ - INFO - No date information found in query: 'summarise the documents from last year'. Proceeding without date filter.
2025-07-09 16:38:30,528 - __main__ - INFO - Successfully processed query
2025-07-09 16:40:03,012 - __main__ - INFO - Successfully connected to MongoDB
